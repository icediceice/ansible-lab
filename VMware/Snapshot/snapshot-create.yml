---
- hosts: localhost
  
  tasks:
    - name: Include Secret Environment Items
      include_vars:
        file: secrets.yml
        name: secret

    - name: snapshots
  community.vmware.vmware_guest_snapshot:
    hostname: "{{secret.vcenter}}"
    username: "{{secret.username}}"
    password: "{{secret.password}}"
    datacenter: "DC"
    folder: "/{{ datacenter_name }}/vm/"
    name: "test"
    state: present
    snapshot_name: Ansible-Prepatch-Snapshot
    description: The server is being patch and currently snapshot is holding for restoration
  delegate_to: localhost